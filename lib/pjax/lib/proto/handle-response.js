var clone=require("../util/clone"),newUid=require("../uniqueid"),trigger=require("../events/trigger");module.exports=function(e,t,o,r){if((r=clone(r||this.options)).request=t,!1===e)trigger(document,"pjax:complete pjax:error",r);else{var n=window.history.state||{},n=(window.history.replaceState({url:n.url||window.location.href,title:n.title||document.title,uid:n.uid||newUid(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href),o),t=(t.responseURL?o!==t.responseURL&&(o=t.responseURL):t.getResponseHeader("X-PJAX-URL")?o=t.getResponseHeader("X-PJAX-URL"):t.getResponseHeader("X-XHR-Redirected-To")&&(o=t.getResponseHeader("X-XHR-Redirected-To")),document.createElement("a")),n=(t.href=n,t.hash);t.href=o,n&&!t.hash&&(t.hash=n,o=t.href),this.state.href=o,this.state.options=r;try{this.loadContent(e,r)}catch(e){if(trigger(document,"pjax:error",r),this.options.debug)throw e;return console&&console.error&&console.error("Pjax switch fail: ",e),this.latestChance(o)}}};